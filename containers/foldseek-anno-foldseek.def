Bootstrap: docker
From: python:3.7-slim-bullseye 

%labels
    App foldseek
    Source https://github.com/steineggerlab/foldseek

%environment
    export PATH=/opt/foldseek/foldseek/bin:$PATH

%post
    set -eux
    python3 -m pip install --upgrade pip

    python3 -m pip install wget 


    # Make foldseek dir
    mkdir -p /opt/foldseek
    cd /opt/foldseek

    # Download precompiled binary
    # You can change VERSION to a release tag or "latest"
    VERSION="10-941cd33"
    BINARY_URL="https://github.com/steineggerlab/foldseek/releases/download/$VERSION/foldseek-linux-gpu.tar.gz"

    # Fetch binary without apt or git
    python3 -c "import wget; wget.download('${BINARY_URL}', 'foldseek.tar.gz')"

    tar -xzf foldseek.tar.gz
    rm foldseek.tar.gz

    # Ensure binary is executable
    chmod +x foldseek

%runscript
    exec foldseek "$@"

%help
    FoldSeek container, CPU/GPU ready.
    Binaries are precompiled â€” no compilation, no apt-get, no git required.
    Use GPU if host has CUDA installed.